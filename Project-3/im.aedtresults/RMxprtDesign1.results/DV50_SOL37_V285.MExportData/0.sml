//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup1
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=0.0134214 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=0.0134214 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=0.0134214 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup1_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup1_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=62.5404 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=0.00388427 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=3 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=4.33924e-005, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.000153001, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.668533 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=0.0120161 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=0.0043769 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.000130177 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.000163417 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.000163417 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.000459003 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=3 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=62.5404 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=0.00388427 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-3 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=4.33924e-005, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.000153001, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.668533 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=0.0120161 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=0.0043769 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.000130177 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.000163417 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.000163417 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.000459003 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-3 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.000627774, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=3 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l1_table pwl TABLE=( 51, 0, 76.8609, 153.722, 230.583, 307.443,\
 384.304, 461.165, 538.026, 614.887, 691.748, 768.609, 845.469, 922.33,\
 999.191, 1076.05, 1152.91, 1229.77, 1306.63, 1383.5, 1460.36, 1537.22,\
 1614.08, 1690.94, 1767.8, 1844.66, 1921.52, 1998.38, 2075.24, 2152.1, 2228.96,\
 2305.83, 2382.69, 2459.55, 2536.41, 2613.27, 2690.13, 2766.99, 2843.85,\
 2920.71, 2997.57, 3074.43, 3151.29, 3228.16, 3305.02, 3381.88, 3458.74,\
 3535.6, 3612.46, 3689.32, 3766.18, 3843.04, 1, 0.000630363, 0.000630189,\
 0.000630017, 0.000629846, 0.000629675, 0.000629506, 0.000629337, 0.00062917,\
 0.000629003, 0.000628837, 0.000628672, 0.000628508, 0.000628344, 0.000628182,\
 0.00062802, 0.000627859, 0.000627585, 0.000627268, 0.000626955, 0.000626645,\
 0.000626338, 0.000626034, 0.000625733, 0.000625435, 0.00062514, 0.000624847,\
 0.000624558, 0.000624271, 0.000623987, 0.000623705, 0.000623426, 0.000622993,\
 0.00062237, 0.000621759, 0.00062116, 0.000620573, 0.000619997, 0.000619432,\
 0.000618877, 0.000618332, 0.000617797, 0.000617272, 0.000616756, 0.000616248,\
 0.000615749, 0.000615258, 0.000614654, 0.000613434, 0.000612262, 0.000611037,\
 0.000609035) CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l2_table pwl TABLE=( 51, 0, 76.8609, 153.722, 230.583, 307.443,\
 384.304, 461.165, 538.026, 614.887, 691.748, 768.609, 845.469, 922.33,\
 999.191, 1076.05, 1152.91, 1229.77, 1306.63, 1383.5, 1460.36, 1537.22,\
 1614.08, 1690.94, 1767.8, 1844.66, 1921.52, 1998.38, 2075.24, 2152.1, 2228.96,\
 2305.83, 2382.69, 2459.55, 2536.41, 2613.27, 2690.13, 2766.99, 2843.85,\
 2920.71, 2997.57, 3074.43, 3151.29, 3228.16, 3305.02, 3381.88, 3458.74,\
 3535.6, 3612.46, 3689.32, 3766.18, 3843.04, 1, 0.000235307, 0.000235063,\
 0.00023482, 0.000234578, 0.000234338, 0.000234098, 0.000233859, 0.000233622,\
 0.000233385, 0.000233149, 0.000232915, 0.000232681, 0.000232448, 0.000232216,\
 0.000231986, 0.000231756, 0.000231363, 0.000230909, 0.000230459, 0.000230012,\
 0.000229569, 0.00022913, 0.000228694, 0.000228261, 0.000227832, 0.000227406,\
 0.000226983, 0.000226563, 0.000226147, 0.000225733, 0.000225323, 0.000224685,\
 0.000223763, 0.000222856, 0.000221964, 0.000221086, 0.000220222, 0.00021937,\
 0.000218532, 0.000217706, 0.000216892, 0.00021609, 0.000215299, 0.000214519,\
 0.00021375, 0.000212991, 0.000212056, 0.000210155, 0.000208316, 0.00020638,\
 0.00020319) CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_lm_table pwl TABLE=( 51, 0, 6.74656, 12.8959, 18.9302, 24.847,\
 30.5626, 36.2051, 41.8025, 47.3583, 52.8198, 58.2956, 63.759, 69.1984,\
 74.6483, 80.0564, 85.4613, 90.8622, 96.3282, 101.929, 107.531, 113.165,\
 118.946, 124.707, 130.468, 136.201, 141.914, 147.785, 153.912, 160.199,\
 167.099, 174.037, 181.286, 188.633, 196.271, 205.49, 214.722, 224.703,\
 235.249, 248.63, 263.982, 280.222, 357.552, 591.738, 1077.04, 1583.52, 2135.8,\
 2778.15, 3625.05, 4825.34, 6343.87, 8082.16, 1, 0.0102074, 0.0102074,\
 0.0106802, 0.0109135, 0.0110863, 0.0112662, 0.0114125, 0.0115318, 0.011633,\
 0.011734, 0.0118131, 0.0118809, 0.0119422, 0.0119929, 0.0120429, 0.0120871,\
 0.0121265, 0.0121533, 0.0121611, 0.012168, 0.0121708, 0.0121582, 0.0121488,\
 0.0121402, 0.0121348, 0.0121315, 0.0121155, 0.0120806, 0.0120364, 0.0119515,\
 0.0118708, 0.011776, 0.0116824, 0.0115786, 0.0113943, 0.0112251, 0.011033,\
 0.0108311, 0.0105252, 0.010174, 0.00983008, 0.00847448, 0.00558613,\
 0.00332485, 0.00243537, 0.00193459, 0.00158644, 0.0012918, 0.00102755,\
 0.000825009, 0.000681651) CONSTANT NOSPLINE" );
}

}
